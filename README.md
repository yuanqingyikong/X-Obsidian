<<<<<<< HEAD
# X工具集合 (X-Tools)

一个功能丰富的 Obsidian 插件，集成了多种实用工具，帮助您更好地管理和展示笔记内容。

## 🌟 主要功能

### 📝 Halo 博客发布
- **一键发布**：将 Obsidian 笔记直接发布到 Halo 博客系统
- **智能同步**：支持增量发布，避免重复发布未修改的内容
- **强制重发**：提供强制重新发布选项，覆盖已发布的文章
- **元数据支持**：自动解析 frontmatter 中的标题、标签、分类等信息
- **发布历史**：记录所有发布操作的历史记录
- **状态跟踪**：实时显示发布状态和进度

### 🎨 Banner 头图管理
- **动态头图**：为笔记添加美观的头图横幅
- **位置调整**：支持自定义头图的显示位置（X/Y坐标）
- **锁定功能**：可锁定头图位置，防止意外修改
- **快速操作**：提供添加/更改和移除头图的快捷命令

### 📊 数据可视化
- **笔记卡片**：以卡片形式展示笔记信息
- **活跃度热力图**：GitHub 风格的活跃度热力图，可视化您的笔记创建频率
- **自定义配色**：支持自定义热力图的颜色主题和阈值

### ⚙️ 灵活配置
- **图片管理**：支持多种图片来源和自定义图片API
- **博客设置**：完整的 Halo 博客配置选项
- **个性化**：丰富的自定义设置选项

## 🚀 快速开始

### 安装插件
1. 下载插件文件到 Obsidian 插件目录
2. 在 Obsidian 设置中启用「X工具集合」插件
3. 重启 Obsidian

### 配置 Halo 博客
1. 打开插件设置页面
2. 在「Halo 博客设置」部分填写：
   - **博客地址**：您的 Halo 博客 URL（如：`https://your-blog.com`）
   - **访问令牌**：从 Halo 后台获取的 API Token
   - **默认分类**：文章的默认分类
   - **默认标签**：文章的默认标签
   - **自动发布**：是否在上传后自动发布文章

## 📖 使用指南

### Halo 博客发布

#### 基本发布
1. 打开要发布的 Markdown 文件
2. 使用命令面板（Ctrl/Cmd + P）搜索「发布到 Halo 博客」
3. 或使用快捷键执行发布命令
4. 插件会自动解析文件内容并发布到您的博客

#### Frontmatter 配置
在文件开头添加 frontmatter 来自定义文章属性：

```yaml
---
title: 文章标题
slug: article-slug
categories: 
  - 技术
  - 教程
tags:
  - Obsidian
  - 插件开发
banner: https://example.com/banner.jpg
visible: PUBLIC
allowComment: true
pinned: false
excerpt: 文章摘要
---
```

#### 支持的 Frontmatter 字段
- `title`: 文章标题
- `slug`: URL 别名
- `categories`: 分类（数组或字符串）
- `tags`: 标签（数组或字符串）
- `banner`: 头图 URL
- `visible`: 可见性（PUBLIC/INTERNAL/PRIVATE）
- `allowComment`: 是否允许评论
- `pinned`: 是否置顶
- `excerpt`: 文章摘要
- `publishTime`: 发布时间
- `priority`: 优先级

### Banner 头图功能

#### 添加头图
1. 在 frontmatter 中添加 `banner` 字段：
```yaml
---
banner: https://example.com/your-image.jpg
banner_x: 0.5  # 水平位置 (0-1)
banner_y: 0.3  # 垂直位置 (0-1)
banner_lock: false  # 是否锁定位置
---
```

2. 或使用命令「添加/更改 Banner」打开设置对话框

#### 移除头图
使用命令「移除 Banner」可快速移除当前文件的头图设置

### 数据可视化

#### 笔记卡片
在文档中插入代码块：
````markdown
```notecards
```
````
#### 活跃度热力图

在文档中插入代码块：

````markdown
```heatmap
```
````
## ⚙️ 设置选项

### 图片设置
- **图片来源**：选择图片的来源方式
- **附件文件夹路径**：指定附件存储路径
- **图片API地址**：自定义图片API服务
- **图片尺寸**：设置默认的图片宽度和高度

### 热力图设置
- **活跃度阈值**：自定义不同活跃度级别的阈值
- **颜色配置**：自定义热力图的颜色方案

### Halo 博客设置
- **博客地址**：Halo 博客的完整 URL
- **访问令牌**：API 访问令牌
- **默认分类**：新文章的默认分类
- **默认标签**：新文章的默认标签
- **自动发布**：是否在上传后立即发布

## 🔧 命令列表

| 命令                     | 功能                       |
| ------------------------ | -------------------------- |
| 发布到 Halo 博客         | 将当前文件发布到 Halo 博客 |
| 强制重新发布到 Halo 博客 | 强制重新发布，忽略缓存检查 |
| 添加/更改 Banner         | 为当前文件添加或修改头图   |
| 移除 Banner              | 移除当前文件的头图设置     |

## 🐛 故障排除

### 发布失败
1. **检查网络连接**：确保能够访问您的 Halo 博客
2. **验证配置**：检查博客地址和访问令牌是否正确
3. **查看控制台**：打开开发者工具查看详细错误信息
4. **重试发布**：使用「强制重新发布」命令

### 头图不显示
1. **检查图片URL**：确保图片链接有效且可访问
2. **刷新视图**：切换到其他文件再切换回来
3. **重新设置**：移除头图后重新添加

### 热力图异常
1. **检查代码块**：确保使用正确的代码块标识符
2. **重新加载**：重启 Obsidian 或重新加载插件

## 📝 更新日志

### v0.0.1
- 🎉 初始版本发布
- ✨ 支持 Halo 博客发布功能
- ✨ 添加 Banner 头图管理
- ✨ 实现笔记卡片和热力图可视化
- ⚙️ 完整的设置配置界面

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来帮助改进这个插件！

## 📄 许可证

本项目采用 MIT 许可证。


如果这个插件对您有帮助，请考虑给项目点个 ⭐️！
=======
# X-Obsidian Plugin

一个功能强大的 Obsidian 插件，支持将 Markdown 文档发布到 Halo 博客系统，并提供多种实用功能。

## 🚀 主要功能

- **Halo 博客发布**: 一键将 Obsidian 笔记发布到 Halo 博客
- **Vue 组件支持**: 基于 Vue 3 的现代化用户界面
- **热力图可视化**: 显示笔记活动热力图
- **卡片式笔记**: 美观的笔记卡片展示
- **智能缓存**: 避免重复发布，提升性能

## 📦 安装

1. 下载插件文件到 Obsidian 插件目录
2. 在 Obsidian 设置中启用插件
3. 配置 Halo 博客连接信息

## ⚙️ 配置

在插件设置中配置以下信息：
- **Halo 博客地址**: 完整的博客 URL（如：`https://blog.example.com`）
- **访问令牌**: 有效的 Halo API 访问令牌
- **自动发布**: 是否自动发布文章（默认为草稿）

## 📚 开发历史与修改记录

### 🔄 版本演进时间线

#### 第一阶段：基础功能开发 (2024年初)
**初始版本 - Vue 模板搭建**
- 基于 `obsidian-vue-starter` 模板创建项目
- 集成 Vue 3 + TypeScript 开发环境
- 建立基础的插件架构和构建流程

#### 第二阶段：Halo 集成开发 (2024年中期)
**v1.0 - 手动 API 调用实现**
- 实现基础的 Halo 博客发布功能
- 使用原生 `fetch` API 进行网络请求
- 基本的错误处理和用户反馈

#### 第三阶段：API 客户端升级 (2024年下半年)
**v2.0 - 官方 API 客户端集成** 📋 [详见 HALO_API_CLIENT_UPGRADE.md]

**主要改进：**
- 🔧 **依赖升级**: 集成 `@halo-dev/api-client` 和 `axios`
- 🛡️ **类型安全**: 使用官方 TypeScript 类型定义
- 🔄 **错误处理**: 统一的错误响应格式和智能重试机制
- 🚀 **性能优化**: 连接复用、请求超时、指数退避重试
- 🔐 **安全增强**: 安全的 Token 传递和用户代理标识

**技术实现：**
```typescript
// API 客户端初始化
this.axiosInstance = axios.create({
  baseURL: this.settings.haloUrl,
  headers: {
    'Authorization': `Bearer ${this.settings.haloToken}`,
    'Content-Type': 'application/json',
    'User-Agent': 'Obsidian-Halo-Plugin/2.0.0'
  },
  timeout: 30000
});
```

#### 第四阶段：功能完善与优化 (2024年末)
**v3.0 - 全面功能改进** 📋 [详见 HALO_IMPROVEMENTS.md]

**核心改进：**
- 📝 **类型安全**: 完整的 TypeScript 类型定义体系
- 🔄 **智能重试**: 基于错误类型的重试策略（最大3次，指数退避）
- 📊 **缓存机制**: 基于内容哈希的变更检测，避免重复发布
- 📈 **日志系统**: 结构化日志记录，便于调试和监控
- 🎯 **用户体验**: 状态栏指示、发布进度通知、并发控制

**新增功能：**
- 发布历史记录管理
- 强制重新发布选项
- 智能 Slug 生成（支持中文）
- 可见性标准化处理

#### 第五阶段：发布流程重构 (最近)
**v4.0 - 发布机制优化** 📋 [详见 HALO_FIX_NOTES.md]

**问题解决：**
- 🐛 **内容丢失**: 修复文章发布后无内容的问题
- 🔧 **API 格式**: 修正 `draftPost` API 参数格式错误
- ⚡ **流程优化**: 从三步流程简化为一步完成

**发布流程演进：**

1. **第一版修复 - 三步流程**:
   ```
   创建草稿 → 上传内容 → 发布文章 (3个API调用)
   ```

2. **第二版优化 - 一步流程**:
   ```
   一次API调用完成所有操作 (1个API调用)
   ```

3. **第三版修复 - API格式修正**:
   ```typescript
   // 修复前（错误）
   const requestData = { post: postData, content: contentData };
   
   // 修复后（正确）
   const requestData = {
     postRequest: { post: postData, content: contentData }
   };
   ```

**性能提升对比：**
| 指标 | v1.0 | v2.0 | v3.0 | v4.0 |
|------|------|------|------|------|
| API调用次数 | 不确定 | 3次 | 3次 | 1次 |
| 网络延迟影响 | 高 | 中等 | 中等 | 低 |
| 失败概率 | 高 | 中等 | 低 | 极低 |
| 发布速度 | 慢 | 中等 | 快 | 快 |
| 错误处理 | 差 | 好 | 优秀 | 优秀 |

### 🛠️ 技术栈演进

**前端技术：**
- Vue 3 + TypeScript
- Vite 构建工具
- ESLint + Prettier 代码规范

**后端集成：**
- Halo API v1alpha1
- @halo-dev/api-client 官方客户端
- Axios HTTP 客户端

**开发工具：**
- TypeScript 严格模式
- Vue TSC 类型检查
- 自动化构建流程

## 🔧 开发指南

### 环境要求
- Node.js 18+
- pnpm 8.15.4+
- Obsidian 最新版本

### 本地开发
```bash
# 安装依赖
pnpm install

# 开发模式（监听文件变化）
pnpm run dev

# 构建生产版本
pnpm run build

# 类型检查
pnpm run type-check

# 代码格式化
pnpm run format
```

### 项目结构
```
src/
├── starterIndex.ts          # 主插件文件
├── ui/                      # Vue 组件
│   ├── settings.vue         # 设置界面
│   ├── modal.vue           # 模态框组件
│   └── ...
├── processors/             # 内容处理器
│   ├── heatMapProcessor.ts  # 热力图处理
│   └── noteCardsProcessor.ts # 卡片处理
└── styles/                 # 样式文件
```

## 📖 使用说明

### 基本发布
1. 打开要发布的 Markdown 文件
2. 使用命令面板执行 `发布到 Halo 博客`
3. 插件自动检查内容变更，避免重复发布

### 强制发布
1. 使用命令 `强制重新发布到 Halo 博客`
2. 忽略缓存检查，强制重新发布

### 状态监控
- 查看状态栏的发布状态指示
- 观察通知消息了解发布进度
- 检查控制台日志获取详细信息

## 🐛 故障排除

### 常见问题
1. **发布失败**: 检查 Halo URL 和 Token 配置
2. **内容为空**: 确保使用最新版本（已修复）
3. **网络错误**: 检查网络连接和防火墙设置
4. **权限错误**: 确保 Token 具有发布文章的权限

### 调试方法
1. 开启开发者工具查看控制台日志
2. 检查插件设置中的配置信息
3. 尝试使用强制发布功能
4. 查看 Halo 后台的错误日志

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

### 开发规范
- 遵循 TypeScript 严格模式
- 使用 ESLint 和 Prettier 格式化代码
- 编写清晰的提交信息
- 添加必要的测试用例

## 📄 许可证

MIT License

## 🙏 致谢

- 感谢 Obsidian 社区的支持
- 感谢 Halo 团队提供的优秀博客系统
- 感谢所有贡献者和用户的反馈

---

**最后更新**: 2024年12月
**当前版本**: v4.0
**维护状态**: 积极维护中 ✅
>>>>>>> 8caab6d395683be1746a34aab8e9b9d4c80f6122
